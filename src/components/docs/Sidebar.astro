---
const navigation = [
  {
    title: "Presentación",
    items: [{ name: "Inicio", href: "/" }],
  },
  {
    title: "Capítulo I",
    items: [
      { name: "Aspectos Generales", href: "/capitulo-1" },
      { name: "Reseña Histórica", href: "/capitulo-1#resena-historica" },
      { name: "Ubicación", href: "/capitulo-1#ubicacion" },
      { name: "Mapa y Sedes", href: "/capitulo-1#mapa" },
      { name: "Marcas y Logos", href: "/capitulo-1#marcas" },
      { name: "Organigrama", href: "/capitulo-1#trabajadores" },
    ],
  },
  {
    title: "Capítulo II",
    items: [
      { name: "Análisis Estratégico", href: "/capitulo-2" },
      { name: "Visión y Misión", href: "/capitulo-2#vision-mision" },
      { name: "Estructura", href: "/capitulo-2#estructura" },
      { name: "Análisis Interno", href: "/capitulo-2#analisis-interno" },
      { name: "Análisis Externo", href: "/capitulo-2#analisis-externo" },
      { name: "Matriz CAME", href: "/capitulo-2#came" },
      { name: "Mapa Estratégico", href: "/capitulo-2#mapa-estrategico" },
    ],
  },
  {
    title: "Capítulo III",
    items: [
      { name: "Dirección Estratégica", href: "/capitulo-3" },
      { name: "Objetivos", href: "/capitulo-3#objetivos" },
      { name: "Plan Estratégico", href: "/capitulo-3#plan" },
    ],
  },
  {
    title: "Anexos",
    items: [{ name: "Evidencias", href: "/anexos" }],
  },
];

const currentPath = Astro.url.pathname;

function isActive(href: string, current: string): boolean {
  if (href === "/") return current === "/";
  return current.startsWith(href);
}
---

<style>
  .docs-sidebar {
    scrollbar-color: #334155 #1e293b;
  }
  .docs-sidebar::-webkit-scrollbar {
    width: 6px;
  }
  .docs-sidebar::-webkit-scrollbar-track {
    background: #1e293b;
  }
  .docs-sidebar::-webkit-scrollbar-thumb {
    background: #334155;
    border-radius: 3px;
  }
  .docs-sidebar::-webkit-scrollbar-thumb:hover {
    background: #475569;
  }
</style>

<aside
  id="docs-sidebar"
  class="docs-sidebar transition-transform duration-300 bg-slate-50 dark:bg-slate-900 border-r border-gray-200 dark:border-gray-800 z-50 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 w-72 flex flex-col"
>
  <div class="sidebar-nav h-full overflow-y-auto pt-4 flex-1">
    <!-- Header -->
    <div class="px-3 mb-6 flex justify-between items-center">
      <div>
        <h2 class="text-lg font-bold text-text-principal font-playfair">
          Análisis Organizacional
        </h2>
        <p class="text-xs text-text-muted mt-1">Incamotors S.A.C.</p>
      </div>
      <!-- Close Button (Mobile only) -->
      <button
        id="sidebar-close"
        class="md:hidden text-text-muted hover:text-secondary-gold"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Navigation -->
    {
      navigation.map((section) => (
        <div class="sidebar-section">
          <div class="sidebar-title">{section.title}</div>
          <nav class="space-y-1">
            {section.items.map((item) => (
              <a
                href={item.href}
                class={`sidebar-link block px-3 py-2 rounded-md text-sm transition-colors ${
                  isActive(item.href, currentPath)
                    ? "active"
                    : "text-text-secundario hover:bg-gray-100 dark:hover:bg-slate-800 hover:text-text-principal"
                }`}
              >
                {item.name}
              </a>
            ))}
          </nav>
        </div>
      ))
    }
  </div>
</aside>

<script>
  function initSidebar() {
    const sidebar = document.getElementById("docs-sidebar");
    const closeBtn = document.getElementById("sidebar-close");

    // Mobile toggle logic (if there's a mobile open button elsewhere, or just close logic)
    // Assuming there might be a mobile toggle button in the header (not in this file),
    // but for now we just handle the close button inside the sidebar.

    function closeSidebar() {
      sidebar?.classList.add("-translate-x-full");
    }

    closeBtn?.addEventListener("click", closeSidebar);

    // Close sidebar when clicking a link on mobile
    const links = document.querySelectorAll(".sidebar-link");
    links.forEach((link) => {
      link.addEventListener("click", () => {
        if (window.innerWidth < 768) {
          closeSidebar();
        }
      });
    });
  }

  // Run on initial load
  initSidebar();

  // Run on view transitions navigation
  document.addEventListener("astro:page-load", initSidebar);
</script>
